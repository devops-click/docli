#!/usr/bin/env bash
# [[ "${DOCLI_DEBUG:-off}" == "on" ]] && set -exo pipefail || set -eo pipefail
# [[ "${DOCLI_UNSET_VARS:-off}" == "on" ]] && set -u
############################################################################### #dltbr
#              https://DevOps.click - DevOps taken seriously                  # #dltbr
###############################################################################
#                             docli pre-env script
###############################################################################
#-----------------------------------------------------------------------------;
#                                PRE ENVS SCRIPT                              |
#-----------------------------------------------------------------------------'
# Component to be loaded by all docli modules that calls docli_pre_envs

## DOCLI MODULE INFORMATION
[[ "${BASH_SOURCE[0]}" != "" ]] && REAL_PATH=$(realpath "${BASH_SOURCE[0]}") || REAL_PATH=$(realpath "$0")
DOCLI_MODULE_VERSION=0.0.01
DOCLI_MODULE="$(basename "${BASH_SOURCE[0]}")"
DOCLI_MODULE_TYPE="$(basename "$(dirname "$($REAL_PATH)")")"
DOCLI_MODULE_UPPER=$(echo "$DOCLI_MODULE" | tr '[:lower:]' '[:upper:]')

## VERBOSE INFORMATION
[[ "${DOCLI_VERBOSE:-off}" == "on" ]] && echo -e "\n***** $DOCLI_MODULE version $DOCLI_MODULE_VERSION ($DOCLI_MODULE_TYPE) *****\n"

# Prevents script from being called directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  echo "* $DOCLI_MODULE: This module cannot be called directly! Exiting... *"
  exit 1
fi
############################################
# DEVELOPER MODE
############################################
: "${DOCLI:=$HOME/devops}"
: "${DOCLI_DEVELOPER_MODE:=false}"
: "${DOCLI_REPOSITORY:-$HOME/GitHub/docli}"

if [[ $DOCLI_DEVELOPER_MODE == true ]]; then
  [[ "${DOCLI_VERBOSE:-off}" == "on" && ${DOCLI_DEBUG:-false} == "true" ]] && echo -e "* $DOCLI_MODULE: DEVELOPER_MODE ONNN *"
  export DOCLI_DIR="${DOCLI_REPOSITORY}/.devops"
else
  export DOCLI_DIR=$DOCLI
fi

# Set the right /bin path after determine if Developer Mode is on or off
PATH="$PATH:$DOCLI_DIR/bin:/opt/homebrew/bin"
############################################

# source $DOCLI_DIR/functions/bash_basic_functions
# docli_params_load

[[ "${DOCLI_VERBOSE:-off}" == "on" ]] && echo "* Sourcing: $DOCLI_DIR/functions/x_docli_pre_envs"
source $DOCLI_DIR/functions/x_docli_pre_envs "$@"
