#!/usr/bin/env bash
# [[ ${DOCLI_DEBUG:-false} == true ]] && set -exo pipefail || set -eo pipefail
# [[ ${DOCLI_UNSET_VARS:-false} == true ]] && set -u
############################################################################### #dltbr
#              https://DevOps.click - DevOps taken seriously                  # #dltbr
###############################################################################
# PS: This script is intended to be used as source for others.
# Basic Bash Cloud Provider Check for CI/CD pipelines
###############################################################################

## DOCLI MODULE INFORMATION
DOCLI_MODULE=bash_basic_cloud_providers
DOCLI_MODULE_TYPE=functions
DOCLI_MODULE_VERSION=0.0.01
DOCLI_MODULE_UPPER=$(echo "$DOCLI_MODULE" | tr '[:lower:]' '[:upper:]')

## DEBUG INFORMATION
[[ ${DOCLI_DEBUG:-false} == true ]] && echo -e "\n***** $DOCLI_MODULE version $DOCLI_MODULE_VERSION ($DOCLI_MODULE_TYPE) *****\n"

# Prevents script from being called directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  echo "* $DOCLI_MODULE: This module cannot be called directly! Exiting... *"
  exit 1
fi

# Usage: check_providers $DOCLI_PARAM_CLOUD

function check_providers {
  # Load Basic Functions such as contains
  source "$DOCLI_DIR/functions/bash_basic_functions"

  # List of valid parameters
  VALID_PROVIDERS=(
    aws
    azure
    bitbucket
    elastic
    gcp
    vault
  )

  # Validate the provided cloud provider
  if ! contains "$1" "${VALID_PROVIDERS[@]}"; then
    echo "Error: Invalid cloud provider."
    # help
    exit 1
  fi
  echo "** Valid provider supplied. Proceeding..."
}